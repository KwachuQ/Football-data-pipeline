{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.11", "generated_at": "2025-11-25T17:17:16.769795Z", "invocation_id": "453275e5-b3fb-4892-8c4b-cbd54201b1cc", "invocation_started_at": "2025-11-25T17:17:15.166470Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-25T17:17:16.596737Z", "completed_at": "2025-11-25T17:17:16.609798Z"}, {"name": "execute", "started_at": "2025-11-25T17:17:16.611011Z", "completed_at": "2025-11-25T17:17:16.719663Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.12665891647338867, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.sofascore_pipeline.mart_team_btts_analysis", "compiled": true, "compiled_code": "\n\nwith match_data as (\n    select\n        fm.season_id,\n        fm.season_name,\n        fm.season_year,\n        fm.match_id,\n        fm.match_date,\n        fm.home_team_id,\n        fm.home_team_name,\n        fm.away_team_id,\n        fm.away_team_name,\n        fm.home_score,\n        fm.away_score,\n        fm.winner_code,\n        -- BTTS indicator\n        case when fm.home_score > 0 and fm.away_score > 0 then 1 else 0 end as btts,\n        -- Clean sheet indicators\n        case when fm.away_score = 0 then 1 else 0 end as home_clean_sheet,\n        case when fm.home_score = 0 then 1 else 0 end as away_clean_sheet,\n        -- xG data from fact_team_match\n        coalesce(ftm_home.stat_expectedgoals, 0) as home_xg,\n        coalesce(ftm_away.stat_expectedgoals, 0) as away_xg\n    from \"dwh\".\"silver\".\"fact_match\" fm\n    left join \"dwh\".\"silver\".\"fact_team_match\" ftm_home \n        on fm.match_id = ftm_home.match_id \n        and fm.home_team_id = ftm_home.team_id \n        and ftm_home.period = 'ALL'\n    left join \"dwh\".\"silver\".\"fact_team_match\" ftm_away \n        on fm.match_id = ftm_away.match_id \n        and fm.away_team_id = ftm_away.team_id \n        and ftm_away.period = 'ALL'\n    where fm.status_type = 'finished'\n),\nteam_overall_stats as (\n    -- Overall statistics (all matches combined)\n    select\n        team_id,\n        team_name,\n        season_id,\n        season_name,\n        season_year,\n        count(*) as matches_played,\n        \n        -- Win percentage\n        sum(case when is_win = 1 then 1 else 0 end)::numeric / nullif(count(*), 0) * 100 as win_pct,\n        \n        -- Goals\n        round(avg(goals_for), 2) as avg_goals_per_match,\n        round(avg(goals_for), 2) as avg_scored,\n        round(avg(goals_against), 2) as avg_conceded,\n        \n        -- BTTS percentage\n        sum(btts)::numeric / nullif(count(*), 0) * 100 as btts_pct,\n        \n        -- Clean sheet percentage\n        sum(clean_sheet)::numeric / nullif(count(*), 0) * 100 as clean_sheet_pct,\n        \n        -- xG metrics\n        round(avg(xg_for), 2) as avg_xg,\n        round(avg(xg_against), 2) as avg_xga\n    from (\n        -- Home matches\n        select\n            home_team_id as team_id,\n            home_team_name as team_name,\n            season_id,\n            season_name,\n            season_year,\n            home_score as goals_for,\n            away_score as goals_against,\n            case when winner_code = 1 then 1 else 0 end as is_win,\n            btts,\n            home_clean_sheet as clean_sheet,\n            home_xg as xg_for,\n            away_xg as xg_against\n        from match_data\n        \n        union all\n        \n        -- Away matches\n        select\n            away_team_id as team_id,\n            away_team_name as team_name,\n            season_id,\n            season_name,\n            season_year,\n            away_score as goals_for,\n            home_score as goals_against,\n            case when winner_code = 2 then 1 else 0 end as is_win,\n            btts,\n            away_clean_sheet as clean_sheet,\n            away_xg as xg_for,\n            home_xg as xg_against\n        from match_data\n    ) all_matches\n    group by team_id, team_name, season_id, season_name, season_year\n),\nteam_home_stats as (\n    -- Home statistics\n    select\n        home_team_id as team_id,\n        home_team_name as team_name,\n        season_id,\n        season_name,\n        season_year,\n        count(*) as home_matches_played,\n        \n        -- Win percentage\n        sum(case when winner_code = 1 then 1 else 0 end)::numeric / nullif(count(*), 0) * 100 as home_win_pct,\n        \n        -- Goals\n        round(avg(home_score + away_score), 2) as home_avg_goals_per_match,\n        round(avg(home_score), 2) as home_avg_scored,\n        round(avg(away_score), 2) as home_avg_conceded,\n        \n        -- BTTS percentage\n        sum(btts)::numeric / nullif(count(*), 0) * 100 as home_btts_pct,\n        \n        -- Clean sheet percentage\n        sum(home_clean_sheet)::numeric / nullif(count(*), 0) * 100 as home_clean_sheet_pct,\n        \n        -- xG metrics\n        round(avg(home_xg), 2) as home_avg_xg,\n        round(avg(away_xg), 2) as home_avg_xga\n    from match_data\n    group by home_team_id, home_team_name, season_id, season_name, season_year\n),\nteam_away_stats as (\n    -- Away statistics\n    select\n        away_team_id as team_id,\n        away_team_name as team_name,\n        season_id,\n        season_name,\n        season_year,\n        count(*) as away_matches_played,\n        \n        -- Win percentage\n        sum(case when winner_code = 2 then 1 else 0 end)::numeric / nullif(count(*), 0) * 100 as away_win_pct,\n        \n        -- Goals\n        round(avg(home_score + away_score), 2) as away_avg_goals_per_match,\n        round(avg(away_score), 2) as away_avg_scored,\n        round(avg(home_score), 2) as away_avg_conceded,\n        \n        -- BTTS percentage\n        sum(btts)::numeric / nullif(count(*), 0) * 100 as away_btts_pct,\n        \n        -- Clean sheet percentage\n        sum(away_clean_sheet)::numeric / nullif(count(*), 0) * 100 as away_clean_sheet_pct,\n        \n        -- xG metrics\n        round(avg(away_xg), 2) as away_avg_xg,\n        round(avg(home_xg), 2) as away_avg_xga\n    from match_data\n    group by away_team_id, away_team_name, season_id, season_name, season_year\n)\nselect\n    ov.team_id,\n    ov.team_name,\n    ov.season_id,\n    ov.season_name,\n    ov.season_year,\n    \n    -- Overall stats\n    ov.matches_played,\n    round(ov.win_pct, 1) as overall_win_pct,\n    ov.avg_goals_per_match as overall_avg_goals_per_match,\n    ov.avg_scored as overall_avg_scored,\n    ov.avg_conceded as overall_avg_conceded,\n    round(ov.btts_pct, 1) as overall_btts_pct,\n    round(ov.clean_sheet_pct, 1) as overall_clean_sheet_pct,\n    ov.avg_xg as overall_avg_xg,\n    ov.avg_xga as overall_avg_xga,\n    \n    -- Home stats\n    hs.home_matches_played,\n    round(hs.home_win_pct, 1) as home_win_pct,\n    hs.home_avg_goals_per_match,\n    hs.home_avg_scored,\n    hs.home_avg_conceded,\n    round(hs.home_btts_pct, 1) as home_btts_pct,\n    round(hs.home_clean_sheet_pct, 1) as home_clean_sheet_pct,\n    hs.home_avg_xg,\n    hs.home_avg_xga,\n    \n    -- Away stats\n    aws.away_matches_played,\n    round(aws.away_win_pct, 1) as away_win_pct,\n    aws.away_avg_goals_per_match,\n    aws.away_avg_scored,\n    aws.away_avg_conceded,\n    round(aws.away_btts_pct, 1) as away_btts_pct,\n    round(aws.away_clean_sheet_pct, 1) as away_clean_sheet_pct,\n    aws.away_avg_xg,\n    aws.away_avg_xga\nfrom team_overall_stats ov\nleft join team_home_stats hs \n    on ov.team_id = hs.team_id \n    and ov.season_id = hs.season_id\nleft join team_away_stats aws \n    on ov.team_id = aws.team_id \n    and ov.season_id = aws.season_id\norder by season_year desc, overall_btts_pct desc", "relation_name": "\"dwh\".\"gold\".\"mart_team_btts_analysis\"", "batch_results": null}], "elapsed_time": 0.30098724365234375, "args": {"use_colors_file": true, "use_fast_test_edges": false, "require_all_warnings_handled_by_warn_error": false, "upload_to_artifacts_ingest_api": false, "require_batched_execution_for_custom_microbatch_strategy": false, "select": ["mart_team_btts_analysis"], "log_format": "default", "log_file_max_bytes": 10485760, "invocation_command": "dbt run --select mart_team_btts_analysis", "defer": false, "require_nested_cumulative_type_params": false, "state_modified_compare_vars": false, "exclude": [], "introspect": true, "require_generic_test_arguments_property": true, "static_parser": true, "strict_mode": false, "which": "run", "show_all_deprecations": false, "log_format_file": "debug", "vars": {}, "profiles_dir": "/opt/dbt/profiles", "populate_cache": true, "skip_nodes_if_on_run_start_fails": false, "partial_parse": true, "require_resource_names_without_spaces": true, "send_anonymous_usage_stats": true, "source_freshness_run_project_hooks": true, "state_modified_compare_more_unrendered_values": false, "cache_selected_only": false, "log_path": "/opt/dbt/project/logs", "printer_width": 80, "quiet": false, "macro_debugging": false, "indirect_selection": "eager", "require_yaml_configuration_for_mf_time_spines": false, "print": true, "require_explicit_package_overrides_for_builtin_materializations": true, "partial_parse_file_diff": true, "favor_state": false, "show_resource_report": false, "use_colors": true, "project_dir": "/opt/dbt/project", "validate_macro_args": false, "version_check": true, "log_level": "info", "empty": false, "log_level_file": "debug", "warn_error_options": {"error": [], "warn": [], "silence": []}, "write_json": true}}